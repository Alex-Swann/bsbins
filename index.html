<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bishop's Stortford New Bin Collection Lookup</title>
  <style>
    .black { color: black; }
    .blue { color: #007BFF; }        /* bright blue */
    .purple { color: #800080; }     /* purple */
    .brown { color: #8B4513; }      /* brown */
    .food { color: #228B22; }       /* forest green for food/compost */
    .title {
        font-size: 2em;
        font-weight: bold;
        line-height: 1.2;
    }
    .title span {
        display: block; /* forces new line */
        font-weight: normal;
        font-size: 1.2em;
        margin-top: 0.1em;
    }
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 1rem auto;
      padding: 0 1rem;
    }
    label, input, button {
      display: block;
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    input#postcode,
    input#housenumber {
      width: 100%;
      max-width: 400px;
      box-sizing: border-box;
      font-size: 1rem;
      padding: 0.4rem 0.5rem;
    }
    button {
      padding: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      max-width: 400px;
    }
    #results p,
    #results ul {
      margin-top: 1rem;
    }
    @media (max-width: 400px) {
      body {
        padding: 0 0.5rem;
      }
      input#postcode,
      input#housenumber,
      button {
        max-width: 100%;
        width: 100%;
      }
      button {
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <h1 class="title">
    Bishop's Stortford <span>New Bin Collection Lookup</span>
  </h1>
  <label for="postcode">Postcode</label>
  <input id="postcode" type="text" placeholder="e.g. CM23 5HE or CM235HE" />

  <label for="housenumber">House Number</label>
  <input id="housenumber" type="text" placeholder="e.g. 41" />

  <button id="getCollections">Get Bin Collections</button>

  <div id="results"></div>

<script>
  // Your bin cycle as you prefer it
  const binCycle = [
    ['black', 'brown', 'food'],    // Week 1 (week commencing 4 Aug 2025)
    ['blue', 'food'],              // Week 2
    ['purple', 'brown', 'food'],   // Week 3
    ['black', 'food'],             // Week 4
    ['blue', 'brown', 'food'],     // Week 5
    ['purple', 'food']             // Week 6
  ];

  // Format date as e.g. Monday 4th August 2025
  function formatDate(date) {
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];

    const dayName = days[date.getDay()];
    const dayNum = date.getDate();
    const monthName = months[date.getMonth()];
    const year = date.getFullYear();

    function nth(d) {
      if (d > 3 && d < 21) return 'th';
      switch (d % 10) {
        case 1:  return "st";
        case 2:  return "nd";
        case 3:  return "rd";
        default: return "th";
      }
    }

    return `${dayName} ${dayNum}${nth(dayNum)} ${monthName} ${year}`;
  }

  // Get the Monday of the week for a given date
  function getMonday(d) {
    d = new Date(d);
    const day = d.getDay();
    const diff = (day === 0 ? -6 : 1) - day; // adjust when day is Sunday
    d.setDate(d.getDate() + diff);
    return d;
  }

  // Render collections list into container element
  function renderCollections(collections, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = ''; // clear existing content

    // Determine start week date: 4 Aug 2025 or next Monday if today is after
    const fixedMonday = new Date('2025-08-04T00:00:00');
    const todayMonday = getMonday(new Date());
    const startDate = todayMonday < fixedMonday ? fixedMonday : todayMonday;

    // Find current week index in binCycle relative to startDate
    // Number of weeks passed since fixedMonday
    const weeksPassed = Math.floor((getMonday(todayMonday) - getMonday(fixedMonday)) / (7 * 24 * 60 * 60 * 1000));
    // This pointer starts cycle at right place
    const startWeek = weeksPassed >= 0 ? weeksPassed % binCycle.length : 0;

    const ul = document.createElement('ul');

    for (let i = 0; i < 6; i++) {
      const weekIndex = (startWeek + i) % binCycle.length;
      const weekDate = new Date(startDate.getTime() + i * 7 * 24 * 60 * 60 * 1000);

      const li = document.createElement('li');
      li.innerHTML = `<strong>Week ${i + 1} (${formatDate(weekDate)}):</strong>`;

      const binsContainer = document.createElement('div');
      binsContainer.style.marginLeft = '1em';

      binCycle[weekIndex].forEach(binType => {
        const found = collections.find(c => c.binType.toLowerCase() === binType);
        if (found) {
          let material = '';
          switch (binType) {
            case 'black': material = 'Refuse'; break;
            case 'blue': material = 'Paper/Card'; break;
            case 'purple': material = 'Recycling'; break;
            case 'brown': material = 'Garden Waste'; break;
            case 'food': material = 'Food/Compost'; break;
            default: material = found.serviceName || binType; break;
          }
          const binLine = document.createElement('div');
          binLine.textContent = `${binType.charAt(0).toUpperCase() + binType.slice(1)} (${material})`;
          binLine.classList.add(binType.toLowerCase());
          binsContainer.appendChild(binLine);
        }
      });

      if (!binsContainer.hasChildNodes()) {
        const noBins = document.createElement('div');
        noBins.textContent = 'No collection';
        binsContainer.appendChild(noBins);
      }

      li.appendChild(binsContainer);
      ul.appendChild(li);
    }

    container.appendChild(ul);
  }
</script>
</body>
</html>
